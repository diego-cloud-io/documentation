<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-deployment-guide/security">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Security | Diego</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://diego-cloud-io.github.io/documentation/docs/deployment-guide/security"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Security | Diego"><meta data-rh="true" name="description" content="Diego provisions strong foundations for security for your AWS EKS cluster. Using a CloudFormation stack Diego installs a number of AWS IAM (Identity and Access Management) resources detailed below."><meta data-rh="true" property="og:description" content="Diego provisions strong foundations for security for your AWS EKS cluster. Using a CloudFormation stack Diego installs a number of AWS IAM (Identity and Access Management) resources detailed below."><link data-rh="true" rel="icon" href="/documentation/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://diego-cloud-io.github.io/documentation/docs/deployment-guide/security"><link data-rh="true" rel="alternate" href="https://diego-cloud-io.github.io/documentation/docs/deployment-guide/security" hreflang="en"><link data-rh="true" rel="alternate" href="https://diego-cloud-io.github.io/documentation/docs/deployment-guide/security" hreflang="x-default"><link rel="stylesheet" href="https://maxst.icons8.com/vue-static/landings/line-awesome/line-awesome/1.3.0/css/line-awesome.min.css"><link rel="stylesheet" href="/documentation/assets/css/styles.19235761.css">
<link rel="preload" href="/documentation/assets/js/runtime~main.715c36a5.js" as="script">
<link rel="preload" href="/documentation/assets/js/main.ff689664.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/documentation/"><div class="navbar__logo"><img src="/documentation/img/logoLight.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/documentation/img/logoDark.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div></a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/deployment-guide/introduction">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/deployment-guide/planning-guidance">Planning Guidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/deployment-guide/deployment-assets">Deployment Assets</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/documentation/docs/deployment-guide/security">Security</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/deployment-guide/operation-guidance">Operation Guidance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/deployment-guide/support">Support</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/documentation/docs/deployment-guide/teardown">Teardown Diego setup</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/documentation/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Security</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Security</h1><p>Diego provisions strong foundations for security for your AWS EKS cluster. Using a CloudFormation <a href="https://github.com/diego-cloud-io/diego-tooling-template/blob/main/aws/diego-base-cf-stack.yaml" target="_blank" rel="noopener noreferrer">stack</a> Diego installs a number of <a href="https://aws.amazon.com/iam/" target="_blank" rel="noopener noreferrer">AWS IAM</a> (Identity and Access Management) resources detailed below.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conforming-to-aws-best-practices">Conforming to AWS Best Practices<a class="hash-link" href="#conforming-to-aws-best-practices" title="Direct link to heading">​</a></h2><p>Diego conforms to a set of <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html" target="_blank" rel="noopener noreferrer">AWS security best practices</a>:</p><ul><li><a href="https://aws.amazon.com/iam/features/manage-roles/#:~:text=AWS%20Identity%20and%20Access%20Management%20(IAM)%20roles%20are%20entities%20you,scoped%20by%20those%20IAM%20roles." target="_blank" rel="noopener noreferrer">AWS IAM roles</a> are assigned specific permissions that allow trusted identities to perform actions in AWS. These roles are given &quot;least-privilege&quot; permissions to perform tasks. </li><li><a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies.html" target="_blank" rel="noopener noreferrer">AWS IAM policies</a> are setup with specific permissions and assigned to roles.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iam-roles">IAM Roles<a class="hash-link" href="#iam-roles" title="Direct link to heading">​</a></h3><table><thead><tr><th>IAM role</th><th>Purpose</th></tr></thead><tbody><tr><td><code>DiegoAppControllerRole</code></td><td>Assumed by the Diego Application Controller using IRSA. Role assumption is restricted to just the service account being used by the controller. Used to create ECR repositories for your Diego enabled applications.</td></tr><tr><td><code>DiegoCIRole</code></td><td>Assumed by Diego&#x27;s Continuous Integration (CI) workflow running in your application repo. The GitHub workflow uses <a href="https://docs.github.com/en/actions/deployment/security-hardening-your-deployments/about-security-hardening-with-openid-connect" target="_blank" rel="noopener noreferrer">Github OIDC (OpenID Connect)</a> to assume this role. It is used to push build artefacts to ECR. Short-lived OIDC tokens for accessing AWS account resources are constrained to only come from your GitHub organization.</td></tr><tr><td><code>DiegoApiRole</code></td><td>Assumed by the Diego API using <a href="https://docs.aws.amazon.com/emr/latest/EMR-on-EKS-DevelopmentGuide/setting-up-enable-IAM.html" target="_blank" rel="noopener noreferrer">IRSA</a>. Role assumption is restricted to just the service account being used by the API. It is used by the API to create and manage ECR repositories and AWS Systems Manager secrets for your Diego applications.</td></tr><tr><td><code>DiegoDnsControllerRole</code></td><td>This role is assumed by the <a href="https://github.com/kubernetes-sigs/external-dns" target="_blank" rel="noopener noreferrer">External DNS Controller</a> using IRSA. Role assumption is restricted to just the service account being used by the controller. The role supports automated management of your Diego Route53 hosted zone.</td></tr><tr><td><code>DiegoLBControllerRole</code></td><td>This role is assumed by <a href="https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html" target="_blank" rel="noopener noreferrer">AWS Load Balancer Controller</a> using IRSA. Role assumption is restricted to just the service account being used by the controller. The role is used to create and manage AWS Elastic Load Balancers to support ingress for your Diego enabled applications.</td></tr><tr><td><code>DiegoAppSecretsReaderRole [Preview\|Staging\|Production]</code></td><td>These roles are assumed by the <a href="https://external-secrets.io/" target="_blank" rel="noopener noreferrer">External Secrets Operator</a> using <a href="https://docs.aws.amazon.com/eks/latest/userguide/iam-roles-for-service-accounts.html" target="_blank" rel="noopener noreferrer">IRSA</a>. Role assumption is restricted to just the service accounts being used by the External Secrets Operator. The roles are used to fetch secrets required by your Diego enabled applications running in preview, staging and production environments.</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iam-policies">IAM Policies<a class="hash-link" href="#iam-policies" title="Direct link to heading">​</a></h3><table><thead><tr><th>IAM Policy</th><th>Assigned To</th><th>Purpose</th></tr></thead><tbody><tr><td><code>diego-ci</code></td><td><code>DiegoCIRole</code></td><td>Allows interactions with AWS Elastic Container Repository (ECR), for container image upload and retrieval your applications.</td></tr><tr><td><code>diego-manage-secrets</code></td><td><code>DiegoApiRole</code></td><td>Allows full management of parameters in <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank" rel="noopener noreferrer">AWS Systems Manager Parameter Store</a><br>Allows <a href="https://docs.aws.amazon.com/Route53/latest/APIReference/API_ChangeResourceRecordSets.html" target="_blank" rel="noopener noreferrer"><code>route53:ChangeResourceRecordSets</code></a> for your Route53 hosted zone.</td></tr><tr><td><code>diego-manage-zone</code></td><td><code>DiegoDnsControllerRole</code></td><td>Allows management of the Route53 hosted zone that was set up for your Diego applications, e.g. <code>diego.&lt;your-organisation&#x27;s-domain&gt;.com</code></td></tr><tr><td><code>diego-manage-alb</code></td><td><code>DiegoLBControllerRole</code></td><td>Allows various permissions related to managing an AWS ELB on behalf of Diego and your Diego enabled applications. For example, creation and deletion of an ALB and listeners within it.</td></tr><tr><td><code>diego-[preview\|staging\|production]-secret-access</code></td><td><code>DiegoAppSecretsReader&lt;env&gt;</code></td><td>Allows reading of AWS Systems Manager Parameter Store secrets constrained to environment specific paths.</td></tr><tr><td><code>diego-create-repository</code></td><td><code>DiegoAppControllerRole</code></td><td>Allows creation of ECR repositories.</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="environment-isolation">Environment Isolation<a class="hash-link" href="#environment-isolation" title="Direct link to heading">​</a></h2><p>Diego implements a logical separation of its own components and your application environments using Kubernetes namespaces. Diego does not implement physical separation of your application environments.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="managing-sensitive-information">Managing Sensitive Information<a class="hash-link" href="#managing-sensitive-information" title="Direct link to heading">​</a></h2><p>Secrets for applications deployed into your EKS cluster are managed via <strong>Diego Hub</strong>. These are stored in the AWS Systems Manager Parameter Store. Secrets are stored as the type <code>SecureString</code>, and are encrypted with the default AWS managed KMS encryption key. Further information on this is provided <a href="https://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-parameter-store.html" target="_blank" rel="noopener noreferrer">here</a></p><p>Separately, secrets for the Diego software are only stored as Kubernetes secrets and your local Diego CLI config file. Installing Diego CLI creates the config file <code>$HOME/.diego/config</code> which is updated as <code>init</code> commands are run with Diego CLI. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="network-configuration">Network Configuration<a class="hash-link" href="#network-configuration" title="Direct link to heading">​</a></h2><p>Diego CLI requires various network configuration has prerequisites, so Diego can be deployed into your AWS EKS cluster. Network requirements for AWS EKS are provided <a href="https://docs.aws.amazon.com/eks/latest/userguide/network_reqs.html" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="public-resources">Public Resources<a class="hash-link" href="#public-resources" title="Direct link to heading">​</a></h2><p>A Diego installation creates the following public resources:</p><ul><li>An internet facing AWS ELB Application Load Balancer with listeners for:<ul><li>Diego Hub</li><li>Dex</li><li>Argo CD</li></ul></li><li>A public Route53 hosted zone for your Diego sub-domain</li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/deployment-guide/security.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/documentation/docs/deployment-guide/deployment-assets"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deployment Assets</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/documentation/docs/deployment-guide/operation-guidance"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Operation Guidance</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#conforming-to-aws-best-practices" class="table-of-contents__link toc-highlight">Conforming to AWS Best Practices</a><ul><li><a href="#iam-roles" class="table-of-contents__link toc-highlight">IAM Roles</a></li><li><a href="#iam-policies" class="table-of-contents__link toc-highlight">IAM Policies</a></li></ul></li><li><a href="#environment-isolation" class="table-of-contents__link toc-highlight">Environment Isolation</a></li><li><a href="#managing-sensitive-information" class="table-of-contents__link toc-highlight">Managing Sensitive Information</a></li><li><a href="#network-configuration" class="table-of-contents__link toc-highlight">Network Configuration</a></li><li><a href="#public-resources" class="table-of-contents__link toc-highlight">Public Resources</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Tech Amigos Ltd, Built with Docusaurus.</div></div></div></footer></div>
<script src="/documentation/assets/js/runtime~main.715c36a5.js"></script>
<script src="/documentation/assets/js/main.ff689664.js"></script>
</body>
</html>